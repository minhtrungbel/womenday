<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home - Women Day</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='fonts.css') }}">
    <link   
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='home.css') }}"
    />

    <!-- T·ªëi ∆∞u iOS: Cho ph√©p m·ªü nh∆∞ app -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  </head>
  <body>
 <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid px-0">

    <!-- LOGO L√íI ƒêU√îI -->
    <a class="navbar-brand logo-outer" href="{{ url_for('home') }}">
      <img src="https://res.cloudinary.com/dogyjotxv/image/upload/v1763570718/home_logo_nt0lkn.svg" 
           alt="Home" 
           class="logo-svg">
    </a>
    <div class="navbar-text-custom">A13‚Ä§2024-2027<br>
      <span>THPT TR·∫¶N KHAI NGUY√äN</span>
    </div>

    <!-- B·ªé HO√ÄN TO√ÄN N√öT TOGGLER + HI·ªÜN LU√îN MENU TR√äN MOBILE -->
    <div class="navbar-collapse collapse show" id="navbarNav">
      <ul class="navbar-nav ms-auto"> <!-- ms-auto = ƒë·∫©y sang ph·∫£i -->
        <li class="nav-item">
          <a class="nav-link active" href="{{ url_for('source') }}">SOURCE</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('link') }}">LINK</a>
        </li>
      </ul>
    </div>

  </div>
</nav>
    <div class="container">
      <h2 class="introduction text-center">
        T·ª•i m√¨nh c√≥ chu·∫©n b·ªã m·ªôt b·∫•t ng·ªù nh·ªè cho b·∫°n n√® üéÅ
      </h2>
      <div class="inner-wrapper">
          <div class="card">
            <form id="name-form" action="{{ url_for('profile') }}" method="GET">
              <label for="name" class="name-label"
                >H√£y ƒëi·ªÅn t√™n c·ªßa b·∫°n v√†o ƒë√¢y nh√©</label>
              <div class="position-relative d-inline-block mx-auto">
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n v√†o"
                  class="form-control name-input text-overflow-ellipsis"
                  autocomplete="off"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary mt-3">G·ª¨I ‚Üí </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div
      id="autocomplete-suggestions"
      class="autocomplete-suggestions"
      style="display: none"
    ></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let names = [];
      fetch("/api/names")
        .then((r) => r.json())
        .then((d) => {
          names = d.names;
        })
        .catch(console.error);

      const input = document.getElementById("name");
      const suggestionsDiv = document.getElementById(
        "autocomplete-suggestions"
      );
      const form = document.getElementById("name-form");

      function updateSuggestionsPosition() {
        const rect = input.getBoundingClientRect();
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;
        const top = rect.bottom + scrollTop + 8;
        const inputWidth = rect.width;
        const maxWidth = window.innerWidth * 0.85;
        suggestionsDiv.style.top = `${top}px`;
        suggestionsDiv.style.width = `${Math.min(inputWidth, maxWidth)}px`;
      }

      function hideSuggestions() {
        suggestionsDiv.innerHTML = "";
        suggestionsDiv.style.display = "none";
      }

      input.addEventListener("input", function () {
        const query = this.value.toLowerCase().trim();
        suggestionsDiv.innerHTML = "";
        suggestionsDiv.style.display = "none";
        if (!query) return;
        const matches = names.filter((n) => n.toLowerCase().includes(query));
        if (matches.length === 0) return;
        matches.forEach((match) => {
          const div = document.createElement("div");
          div.className = "autocomplete-suggestion";
          div.textContent = match;
          div.addEventListener("click", () => {
            input.value = match;
            hideSuggestions();
          });
          suggestionsDiv.appendChild(div);
        });
        updateSuggestionsPosition();
        suggestionsDiv.style.display = "block";
      });

      suggestionsDiv.addEventListener("click", (e) => {
        if (e.target.classList.contains("autocomplete-suggestion")) {
          input.value = e.target.textContent;
          hideSuggestions();
        }
      });

      // === CHUY·ªÇN H∆Ø·ªöNG + ƒê√ÅNH D·∫§U T∆Ø∆†NG T√ÅC (CHO iOS) ===
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        const name = input.value.trim();
        if (!name) return;
        hideSuggestions();

        // ƒê√ÅNH D·∫§U ƒê√É T∆Ø∆†NG T√ÅC TRONG C√ôNG TAB
        sessionStorage.setItem("audio_allowed", "true");

        // CHUY·ªÇN H∆Ø·ªöNG QUA GET
        const url = new URL(this.action, window.location.origin);
        url.searchParams.set("name", name);
        location.href = url.toString();
      });

      ["scroll", "resize"].forEach((ev) => {
        window.addEventListener(ev, () => {
          if (suggestionsDiv.style.display === "block") {
            updateSuggestionsPosition();
          }
        });
      });

      // Touch feedback
      document
        .querySelector(".btn-primary")
        .addEventListener("touchstart", function () {
          this.classList.add("tapped");
        });
      document
        .querySelector(".btn-primary")
        .addEventListener("touchend", function () {
          setTimeout(() => this.classList.remove("tapped"), 100);
        });

      suggestionsDiv.addEventListener(
        "touchstart",
        (e) => {
          if (e.target.classList.contains("autocomplete-suggestion")) {
            e.target.classList.add("tapped");
          }
        },
        true
      );
      suggestionsDiv.addEventListener(
        "touchend",
        (e) => {
          if (e.target.classList.contains("autocomplete-suggestion")) {
            setTimeout(() => e.target.classList.remove("tapped"), 1000);
          }
        },
        true
      );
    </script>
  </body>
</html>
